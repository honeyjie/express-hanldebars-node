define(["jquery","fullpage","scrollbar","base","common","d3"],function(e,t,l,s,n,a){function i(e){var t=100*e;console.log(t);var l=t.toString().indexOf(".");return console.log(l),l!==-1?t.toString().slice(0,l)+"%":t.toString()+"%"}function o(){s.openMask(),$("body").css("overflow","hidden"),$(".select-form-view").removeClass("hidden").addClass("animated fadeInDown").one(s.animationend,function(){$(".select-form-view").removeClass("animated fadeInDown")})}function c(){for(var e=$(".select-box .select-content"),t=1;t<e.length;t++)_[t]=e.eq(t).innerHeight(),e.eq(t).css("height",0),e.eq(t).parents(".select-box").find(".select-title-control").addClass("animated rotateDown")}function r(){g.nation.length>0&&g.locatioin.length>0&&($(".select-box").eq(0).find(".select-title").hasClass("error")?$(".select-box").eq(0).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(1).find(".select-content").css("height")&&$(".select-box").eq(1).find(".select-title-control").click())}function f(){g.pre_school&&g.school_type&&g.pre_major&&g.grade&&null!==g.related_major&&g.degree&&($(".select-box").eq(1).find(".select-title").hasClass("error")?$(".select-box").eq(1).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(2).find(".select-content").css("height")&&$(".select-box").eq(2).find(".select-title-control").click())}function m(){"法学"==g.pre_major?"toefl"==g.language?g.gpa&&g.toefl&&g.toefl_r&&g.toefl_l&&g.toefl_s&&g.toefl_w&&null!==g.lsat&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()):"ielts"==g.language&&g.gpa&&g.ielts&&g.ielts_r&&g.ielts_l&&g.ielts_s&&g.ielts_w&&null!==g.lsat&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()):"toefl"==g.language?"gre"==g.exam?g.gpa&&g.toefl&&g.toefl_r&&g.toefl_l&&g.toefl_s&&g.toefl_w&&g.gre&&g.gre_v&&g.gre_q&&g.gre_aw&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()):"gmat"==g.exam&&g.gpa&&g.toefl&&g.toefl_r&&g.toefl_l&&g.toefl_s&&g.toefl_w&&g.gmat&&g.gmat_v&&g.gmat_q&&g.gmat_aw&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()):"ielts"==g.language&&("gre"==g.exam?g.gpa&&g.ielts&&g.ielts_r&&g.ielts_l&&g.ielts_s&&g.ielts_w&&g.gre&&g.gre_v&&g.gre_q&&g.gre_aw&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()):"gmat"==g.exam&&g.gpa&&g.ielts&&g.ielts_r&&g.ielts_l&&g.ielts_s&&g.ielts_w&&g.gmat&&g.gmat_v&&g.gmat_q&&g.gmat_aw&&($(".select-box").eq(2).find(".select-title").hasClass("error")?$(".select-box").eq(2).find(".select-title").removeClass("error"):"0px"==$(".select-box").eq(3).find(".select-content").css("height")&&$(".select-box").eq(3).find(".select-title-control").click()))}function d(e){$.ajax({url:"/completeform/chinaschool.action",data:{schoolname:e},type:"post",cache:!1,dataType:"html",success:function(e){$("#select-school ul").html(e),$(".select-info-school").find(".form-select-option").removeClass("hidden"),$("#select-school").scrollbar()},error:function(){s.notice("网络错误")}})}function h(e,t){$.ajax({url:"/completeform/chinamajor.action",data:{majorname:e},type:"post",cache:!1,dataType:"html",success:function(e){1==t?($("#select-major ul").html(e),$(".select-info-major").find(".form-select-option").removeClass("hidden"),$("#select-major").scrollbar()):2==t&&($("#select-major2 ul").html(e),$(".select-info-major2").find(".form-select-option").removeClass("hidden"),$("#select-major2").scrollbar())},error:function(){s.notice("网络错误")}})}function u(){function e(e){for(var t=0;t<e.length;t++)if(e[t]>0)return!0;return!1}g.nation.length<=0||g.locatioin<=0?($(".select-box").eq(0).find(".select-title").addClass("error"),0==parseInt($(".select-box").eq(0).find(".select-content").css("height"))&&(v=!0,$(".select-box").eq(0).find(".select-title-control").click()),g.nation.length<=0&&$(".select-country .select-preference-title").addClass("red"),g.locatioin.length<=0&&$(".select-position .select-preference-title").addClass("red")):parseInt($(".select-box").eq(0).find(".select-content").css("height"))>0&&(v=!0,$(".select-box").eq(0).find(".select-title-control").click()),g.pre_school&&g.school_type&&g.pre_major&&g.grade&&null!=g.related_major&&g.degree?parseInt($(".select-box").eq(1).find(".select-content").css("height"))>0&&(v=!0,$(".select-box").eq(1).find(".select-title-control").click()):($(".select-box").eq(1).find(".select-title").addClass("error"),0==parseInt($(".select-box").eq(1).find(".select-content").css("height"))&&(v=!0,$(".select-box").eq(1).find(".select-title-control").click()),g.pre_school&&g.school_type||$(".select-info-school .form-item-name").addClass("red"),g.pre_major||$(".select-info-major .form-item-name").addClass("red"),g.grade||$(".select-school-type .form-item-name").addClass("red"),g.related_major||$(".select-major-only .form-item-name").addClass("red"),g.degree||$(".select-degree .form-item-name").addClass("red"));var t={};t.overall=null,t.R=null,t.L=null,t.S=null,t.W=null;var l={};l.overall=null,l.V=null,l.Q=null,l.AW=null,"toefl"==g.language?(t.overall=g.toefl,t.R=g.toefl_r,t.L=g.toefl_l,t.S=g.toefl_s,t.W=g.toefl_w):"ielts"==g.language&&(t.overall=g.ielts,t.R=g.ielts_r,t.L=g.ielts_l,t.S=g.ielts_s,t.W=g.ielts_w),"gre"==g.exam?(l.overall=g.gre,l.V=g.gre_v,l.Q=g.gre_q,l.AW=g.gre_aw):"gmat"==g.exam&&(l.overall=g.gmat,l.V=g.gmat_v,l.Q=g.gmat_q,l.AW=g.gmat_aw),"法学"==g.pre_major?g.gpa&&g.language&&t.overall&&t.R&&t.L&&t.S&&t.W&&null!=g.lsat?parseInt($(".select-box").eq(2).find(".select-content").css("height"))>0&&(v=!0,$(".select-box").eq(2).find(".select-title-control").click()):($(".select-box").eq(2).find(".select-title").addClass("error"),0==parseInt($(".select-box").eq(2).find(".select-content").css("height"))&&(v=!0,$(".select-box").eq(2).find(".select-title-control").click()),g.gpa||$(".select-score-gpa .form-item-name").addClass("red"),!$.isEmptyObject(g.language)&&t.overall&&t.R&&t.L&&t.S&&t.W||$(".select-language .form-item-name").addClass("red"),null==g.lsat&&$(".select-form-lsat .form-item-name").addClass("red")):g.gpa&&g.language&&t.overall&&t.R&&t.L&&t.S&&t.W&&g.exam&&l.overall&&l.V&&l.Q&&l.AW?parseInt($(".select-box").eq(2).find(".select-content").css("height"))>0&&(v=!0,$(".select-box").eq(2).find(".select-title-control").click()):($(".select-box").eq(2).find(".select-title").addClass("error"),0==parseInt($(".select-box").eq(2).find(".select-content").css("height"))&&(v=!0,$(".select-box").eq(2).find(".select-title-control").click()),g.gpa||$(".select-score-gpa .form-item-name").addClass("red"),!$.isEmptyObject(g.language)&&t.overall&&t.R&&t.L&&t.S&&t.W||$(".select-language .form-item-name").addClass("red"),!$.isEmptyObject(g.exam_score)&&l.overall&&l.V&&l.Q&&l.AW||$(".select-exam .form-item-name").addClass("red"));var n=[0,0,0];return 1!=g.achievement[0]||e(g.international_paper_num)?n[0]=1:n[0]=0,1!=g.achievement[1]||e(g.chinese_paper_num)?n[1]=1:n[1]=0,1!=g.achievement[2]||e(g.meeting_paper_num)?n[2]=1:n[2]=0,1==n[0]&&1==n[1]&&1==n[2]?parseInt($(".select-box").eq(3).find(".select-content").css("height"))>0&&(v=!0,$(".select-box").eq(3).find(".select-title-control").click()):($(".select-box").eq(3).find(".select-title").addClass("error"),$(".select-achievement .form-item-name").eq(0).addClass("red"),0==parseInt($(".select-box").eq(3).find(".select-content").css("height"))&&(v=!0,$(".select-box").eq(3).find(".select-title-control").click())),$(".select-title").hasClass("error")?($(".notice").addClass("red"),void s.notice("页面中有必填项未填，请检查",function(){$(".notice").removeClass("red")})):(formdata={nation:g.nation,locatioin:g.locatioin,pre_school:g.pre_school,school_type:g.school_type,pre_major:g.pre_major,pre_major2:g.pre_major2,grade:g.grade,related_major:g.related_major,degree:g.degree,gpa:g.gpa,toefl:g.toefl,toefl_r:g.toefl_r,toefl_l:g.toefl_l,toefl_s:g.toefl_s,toefl_w:g.toefl_w,ielts:g.ielts,ielts_r:g.ielts_r,ielts_l:g.ielts_l,ielts_s:g.ielts_s,ielts_w:g.ielts_w,gre:g.gre,gre_v:g.gre_v,gre_q:g.gre_q,gre_aw:g.gre_aw,gmat:g.gmat,gmat_v:g.gmat_v,gmat_q:g.gmat_q,gmat_aw:g.gmat_aw,lsat:g.lsat,exchange:g.exchange,science_rank:g.science_rank,science_time:g.science_time,recommend_rank:g.recommend_rank,international_paper_rank:g.international_paper_rank,international_paper_num:g.international_paper_num,chinese_paper_rank:g.chinese_paper_rank,chinese_paper_num:g.chinese_paper_num,meeting_paper_rank:g.meeting_paper_rank,meeting_paper_num:g.meeting_paper_num,work_rank:g.work_rank,work_time:g.work_time,prize:g.prize,match:g.match},void $.ajax({url:"/v1/completeform/saveform.action",data:formdata,type:"post",cache:!1,dataType:"json",success:function(e){0===e.code&&(localStorage.setItem("completedForm",!0),$.ajax({url:"/v1/completeform/intelligentselection.action",type:"GET",cache:!1,dataType:"json",success:function(e){e.data.Sprint||e.data.Middle||e.data.Bottom?window.location.href="/recommendation":($(".select-form-noresult").removeClass("hidden"),$(".mask").removeClass("hidden"))},error:function(){s.notice("网络错误")}}))},error:function(){s.notice("网络错误")}}))}function p(e,t,l,s){function n(e){for(var t=[],l=0;l<e.length;l++)e[l].x<=s.x&&t.push(e[l]);return t}function i(e){for(var t=[],l=0;l<e.length;l++)t.push(e[l].x);for(var s=a.max(t),n=0;n<e.length;n++)if(e[n].x==s)return e[n]}function o(e){for(var t=[],l=0;l<e.length;l++)t.push(e[l].x);for(var s=a.min(t),n=0;n<e.length;n++)if(e[n].x==s)return e[n]}function c(e){for(var t=[],l=0;l<e.length;l++){var s={};s.x=e[l].x,s.y=0,t.push(s)}return t}function r(e){var t={stroke:"",fill:""};return s.x>parseInt(l.x)+parseInt((s.x-l.x)/2)?(t.stroke="#55ccff",t.fill="#bdeafc"):s.x>l.x&&s.x<=parseInt(l.x)+parseInt((s.x-l.x)/2)?(t.stroke="#72d38a",t.fill="#c7f6d5"):s.x<=l.x&&(t.stroke="#f14141",t.fill="#ffcccc"),t}$(e).find("svg")&&$(e).find("svg").remove();var f=n(t),m=i(t),d=o(t),h=r(t),u=c(f),p=c(t),g=500,v=250,_={left:50,top:50,right:50,bottom:25},x=g-_.left-_.right,k=v-_.top-_.bottom,C=a.select(e).append("svg").attr("width",g).attr("height",v).append("g").attr("transform","translate("+_.left+","+_.top+")"),b=a.scaleLinear().domain([d.x,m.x]).range([0,x]),w=a.scaleLinear().domain([0,l.y]).range([k,0]),y=a.area().x(function(e){return b(e.x)}).y0(k).y1(function(e){return w(e.y)}).curve(a.curveCatmullRom.alpha(.5)),q=a.line().x(function(e){return b(e.x)}).y(function(e){return w(e.y)-1}).curve(a.curveCatmullRom.alpha(.5));C.append("path").attr("class","svg-area").style("fill",h.fill).attr("d",y(u)).transition().duration(1e3).attr("d",y(f)),C.append("path").attr("class","svg-line").style("stroke",h.stroke).attr("d",q(p)).transition().duration(1e3).attr("d",q(t)),C.append("g").append("circle").style("fill",h.fill).attr("cx",b(l.x)).attr("cy",k).transition().duration(1e3).attr("cx",b(l.x)).attr("cy",w(l.y)).attr("r",5),C.append("g").append("circle").attr("class","svg-dot").style("stroke",h.stroke).attr("cx",b(s.x)).attr("cy",k).transition().duration(1e3).attr("cx",b(s.x)).attr("cy",w(s.y)).attr("r",5),C.append("g").append("line").style("stroke","#ffffff").style("stroke-width",1).attr("x1",b(l.x)).attr("y1",k).attr("x2",b(l.x)).attr("y2",k).transition().duration(1e3).attr("y2",5),C.append("g").append("line").style("stroke","#dcdcdc").style("stroke-width",1).attr("x1",0).attr("y1",k+2).attr("x2",x).attr("y2",k+2),C.append("g").append("text").attr("x",b(l.x)-36).attr("y",k).transition().duration(1e3).attr("y",w(l.y)-15).text("大多数人得分"),C.append("g").append("text").attr("x",b(s.x)-24).attr("y",k).transition().duration(1e3).attr("y",w(s.y)-15).text("我的得分"),C.append("g").append("text").attr("x",b(l.x)-8).attr("y",k-5),C.append("g").append("text").attr("x",b(s.x)-8).attr("y",k-5),C.append("g").append("text").attr("x",0).attr("y",k+20).text("最低分"),C.append("g").append("text").attr("x",0).attr("y",k-5).text(d.x),C.append("g").append("text").attr("x",x-36).attr("y",k+20).text("最高分"),C.append("g").append("text").attr("x",x-8).attr("y",k-5).text(m.x)}$(".select-school-buttons button").eq(0).click(function(){window.location.href="/form"}),$(".select-school-buttons button").eq(1).click(function(){window.location.href="/addApply"});var g={};g.nation=[],g.locatioin=[],g.pre_school=null,g.school_type=null,g.pre_major=null,g.pre_major2=null,g.grade=null,g.related_major=null,g.degree=null,g.gpa=null,g.language=null,g.toefl=null,g.toefl_r=null,g.toefl_l=null,g.toefl_s=null,g.toefl_w=null,g.ielts=null,g.ielts_r=null,g.ielts_l=null,g.ielts_s=null,g.ielts_w=null,g.exam=null,g.gre=null,g.gre_v=null,g.gre_q=null,g.gre_aw=null,g.gmat=null,g.gmat_v=null,g.gmat_q=null,g.gmat_aw=null,g.lsat=null,g.exchange=[0,0,0],g.science_rank=[0,0,0],g.science_time=[0,0,0],g.recommend_rank=[0,0,0],g.achievement=[0,0,0],g.international_paper_rank=[0,0,0],g.international_paper_num=[0,0,0],g.chinese_paper_rank=[0,0,0],g.chinese_paper_num=[0,0,0],g.meeting_paper_rank=[0,0],g.meeting_paper_num=[0,0],g.work_rank=[0,0,0],g.work_time=[0,0,0],g.prize=0,g.match=0;var v=!0,_=[];$(function(){function e(){for(var e=[],t=0;t<$(".select-info-school .form-select-option li").length;t++)e.push($(".select-info-school .form-select-option li").eq(t).html());return e.indexOf($(".select-school").val())==-1?(g.pre_school=null,g.school_type=null,void s.testFail($(".select-school"),"请从下拉列表中选择学校")):(s.testSuccess($(".select-school")),g.pre_school=$(".select-school").val(),g.school_type=$(".select-school").data("type"),g.pre_school&&g.school_type&&$(".select-info-school .form-item-name").removeClass("red"),void f())}function t(){for(var e=[],t=0;t<$(".select-info-major .form-select-option li").length;t++)e.push($(".select-info-major .form-select-option li").eq(t).html());return e.indexOf($(".select-major").val())==-1?(g.pre_major=null,void s.testFail($(".select-major"),"请从下拉列表中选择专业")):(s.testSuccess($(".select-major")),g.pre_major=$(".select-major").val(),"法学"==g.pre_major?($(".select-form-lsat").removeClass("hidden"),$(".select-exam").addClass("hidden")):($(".select-form-lsat").addClass("hidden"),$(".select-exam").removeClass("hidden")),g.pre_major&&$(".select-info-major .form-item-name").removeClass("red"),void f())}function l(){for(var e=[],t=0;t<$(".select-info-major2 .form-select-option li").length;t++)g.pre_major2=null,e.push($(".select-info-major2 .form-select-option li").eq(t).html());return e.indexOf($(".select-major2").val())==-1?void s.testFail($(".select-major2"),"请从下拉列表中选择专业"):(s.testSuccess($(".select-major2")),void(g.pre_major2=$(".select-major2").val()))}function a(e,t){var l=e.val(),s=/.*\..*/;s.test(l)&&e.val(l.substring(0,l.indexOf(".")+t+1))}$(".select-special").select(),$(".science-select1").select(),$(".science-select2").select(),$(".work-select1").select(),$(".work-select2").select(),$(".prize-select1").select(),$(".prize-select2").select(),$(".select-school-type").radio(),$(".select-major-only").radio(),$(".select-degree").radio(),$(".select-language").radio(),$(".select-exam").radio(),$(".select-exchange").check(),$(".select-science").check(),$(".select-recommend").check(),$(".select-achievement").check(),$(".select-work").check(),$(".select-prize").check(),$(".select-form")[0]&&$(".header-user-info").hasClass("hidden")?n.openIndexLogin():$(".select-form-view")[0]&&(localStorage.getItem("completedForm")||o()),!$(".header-user-info").hasClass("hidden")&&localStorage.getItem("completedForm")&&$(".header-nav li").eq(1).find("a").attr("href","/recommendation"),$(".select-form-view").on("click",function(e){e.stopPropagation()}),$(".select-form-view button").on("click",function(){s.closeAll.closeSelectView()}),c(),$(".select-title").on("click",function(){if(v){v=!1;var e=$(this).parents(".select-box").find(".select-content"),t=$(".select-box").index($(this).parents(".select-box"));_[t]?_[t]&&0!==e.innerHeight()&&(_[t]=e.innerHeight()):_[t]=e.innerHeight(),"0px"==e.css("height")?($(this).find("img").removeClass("animated rotateDown").addClass("animated rotateUp"),e.animate({height:_[t]},200,function(){v=!0})):($(this).find("img").removeClass("animated rotateUp").addClass("animated rotateDown"),e.animate({height:0},200,function(){v=!0}))}}),$(".select-country .select-preference-radio").on("click",function(){$(this).hasClass("active")?(g.nation.splice(g.nation.indexOf($(this).data("value")),1),$(this).removeClass("active")):(g.nation.push($(this).data("value")),$(this).addClass("active"),$(".select-country .select-preference-title").removeClass("red")),r()}),$(".select-position .select-preference-radio").on("click",function(){$(this).hasClass("active")?(g.locatioin.splice(g.locatioin.indexOf($(this).data("value")),1),$(this).removeClass("active")):(g.locatioin.push($(this).data("value")),$(this).addClass("active"),$(".select-position .select-preference-title").removeClass("red")),r()}),$(".select-school").on("input propertychange",function(){d($(this).val())}),$(".select-info-school .form-select-option").on("click","li",function(){$(".select-school").val($(this).html()),$(".select-school").data("type",$(this).data("type")),e()}),$(".select-school").on("blur",function(){setTimeout(function(){e()},300)}),$(".select-major").on("input propertychange",function(){h($(this).val(),1)}),$(".select-info-major .form-select-option").on("click","li",function(){$(".select-major").val($(this).html()),t()}),$(".select-major").on("blur",function(){setTimeout(function(){t()},300)}),$(".select-major2").on("input propertychange",function(){h($(this).val(),2)}),$(".select-info-major2 .form-select-option").on("click","li",function(){$(".select-major2").val($(this).html()),l()}),$(".select-major2").on("blur",function(){setTimeout(function(){l()},300)}),$(".select-school-type .form-radio").on("click",function(){g.grade=$(this).find(".form-radio-value").html(),$(".select-school-type .form-item-name").removeClass("red"),f()}),$(".select-major-only .form-radio").on("click",function(){1==$(this).data("value")?$(".select-info-major2").removeClass("hidden"):0==$(this).data("value")&&$(".select-info-major2").addClass("hidden"),g.related_major=$(this).data("value"),$(".select-major-only .form-item-name").removeClass("red"),f()}),$(".select-degree .form-radio").on("click",function(){g.degree=$(this).data("value"),$(".select-degree .form-item-name").removeClass("red"),f()}),$(".select-gpa").on("input propertychange",function(){var e=$(this).val(),t=/.*\..*/;t.test(e)&&$(this).val(e.substring(0,e.indexOf(".")+3))}),$(".select-gpa").on("blur",function(){$(this).testInput({rule:s.isDouble,success:function(e){return e.val()>100?(g.gpa=null,void s.testFail(e,"您输入的分数有误")):(s.testSuccess(e),void(g.gpa=e.val()))},fail:function(e){g.gpa=null,s.testFail(e,"您输入的分数有误")}}),g.gpa&&$(".select-score-gpa .form-item-name").removeClass("red"),m()}),$(".select-language .form-radio").on("click",function(){$(".select-language-input").hasClass("hidden")&&(_[2]=parseInt(_[2]+$(".select-language-input").innerHeight()+"px"),$(".select-score").css("height",_[2])),$(".select-language-input").removeClass("hidden"),"TOEFL"==$(this).find(".form-radio-value").html()?(g.language="toefl",g.ielts=null,g.ielts_r=null,g.ielts_l=null,g.ielts_s=null,g.ielts_w=null):"IELTS"==$(this).find(".form-radio-value").html()&&(g.language="ielts",g.toefl=null,g.toefl_r=null,g.toefl_l=null,g.toefl_s=null,g.toefl_w=null),$(".select-language-input input").removeClass("error").val("")}),$(".select-language-overall").on("input propertychange",function(){"toefl"==g.language?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>120?(g.toefl=null,void s.testFail(e,"TOFEL有效分值为0~120分")):(g.toefl=e.val(),void s.testSuccess(e))},fail:function(e){g.toefl=null,s.testFail(e,"TOFEL有效分值为0~120分")}}):"ielts"==g.language&&(a($(this),1),$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>9?(g.ielts=null,void s.testFail(e,"IELTS有效分值为0~9分")):(g.ielts=e.val(),void s.testSuccess(e))},fail:function(e){g.ielts=null,s.testFail(e,"IELTS有效分值为0~9分")}}))}),$(".select-language-r").on("input propertychange",function(){"toefl"==g.language?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>30?(g.toefl_r=null,void s.testFail(e,"TOFEL分项成绩有效分值为0~30分")):(g.toefl_r=e.val(),void s.testSuccess(e))},fail:function(e){g.toefl_r=null,s.testFail(e,"TOFEL分项成绩有效分值为0~30分")}}):"ielts"==g.language&&(a($(this),1),$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>9?(g.ielts_r=null,void s.testFail(e,"IELTS分项成绩有效分值为0~9")):(g.ielts_r=e.val(),void s.testSuccess(e))},fail:function(e){g.ielts_r=null,s.testFail(e,"IELTS分项成绩有效分值为0~9")}}))}),$(".select-language-l").on("input propertychange",function(){"toefl"==g.language?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>30?(g.toefl_l=null,void s.testFail(e,"TOFEL分项成绩有效分值为0~30分")):(g.toefl_l=e.val(),void s.testSuccess(e))},fail:function(e){g.toefl_l=null,s.testFail(e,"TOFEL分项成绩有效分值为0~30分")}}):"ielts"==g.language&&(a($(this),1),$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>9?(g.ielts_l=null,void s.testFail(e,"IELTS分项成绩有效分值为0~9")):(g.ielts_l=e.val(),void s.testSuccess(e))},fail:function(e){g.ielts_l=null,s.testFail(e,"IELTS分项成绩有效分值为0~9")}}))}),$(".select-language-s").on("input propertychange",function(){"toefl"==g.language?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>30?(g.toefl_s=null,void s.testFail(e,"TOFEL分项成绩有效分值为0~30分")):(g.toefl_s=e.val(),void s.testSuccess(e))},fail:function(e){g.toefl_s=null,s.testFail(e,"TOFEL分项成绩有效分值为0~30分")}}):"ielts"==g.language&&(a($(this),1),$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>9?(g.ielts_s=null,void s.testFail(e,"IELTS分项成绩有效分值为0~9")):(g.ielts_s=e.val(),void s.testSuccess(e))},fail:function(e){g.ielts_s=null,s.testFail(e,"IELTS分项成绩有效分值为0~9")}}))}),$(".select-language-w").on("input propertychange",function(){"toefl"==g.language?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>30?(g.toefl_w=null,void s.testFail(e,"TOFEL分项成绩有效分值为0~30分")):(g.toefl_w=e.val(),void s.testSuccess(e))},fail:function(e){g.toefl_w=null,s.testFail(e,"TOFEL分项成绩有效分值为0~30分")}}):"ielts"==g.language&&(a($(this),1),$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>9?(g.ielts_w=null,void s.testFail(e,"IELTS分项成绩有效分值为0~9")):(g.ielts_w=e.val(),void s.testSuccess(e))},fail:function(e){g.ielts_w=null,s.testFail(e,"IELTS分项成绩有效分值为0~9")}}))}),$(".select-language-input input").on("focus",function(){$(this).hasClass("error")&&$(this).parent(".form-item").find(".form-item-notice").css("display","block")}),$(".select-language-input input").on("blur",function(){$(this).parent(".form-item").find(".form-item-notice").css("display","none"),"toefl"==g.language?g.toefl&&g.toefl_r&&g.toefl_l&&g.toefl_s&&g.toefl_w&&$(".select-language .form-item-name").removeClass("red"):"ielts"==g.language&&g.ielts&&g.ielts_r&&g.ielts_l&&g.ielts_s&&g.ielts_w&&$(".select-language .form-item-name").removeClass("red"),m()}),$(".select-exam .form-radio").on("click",function(){$(".select-exam-input").hasClass("hidden")&&(_[2]=parseInt(_[2]+$(".select-exam-input").innerHeight()+"px"),$(".select-score").css("height",_[2])),$(".select-exam-input").removeClass("hidden"),"GRE"==$(this).find(".form-radio-value").html()?(g.exam="gre",g.gmat=null,g.gmat_v=null,g.gmat_q=null,g.gmat_aw=null):"GMAT"==$(this).find(".form-radio-value").html()&&(g.exam="gmat",g.gre=null,g.gre_v=null,g.gre_q=null,g.gre_aw=null),$(".select-exam-input input").removeClass("error").val("")}),$(".select-exam-overall").on("input propertychange",function(){"gre"==g.exam?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>340?(g.gre=null,void s.testFail(e,"GRE有效分值为0~340")):(g.gre=e.val(),void s.testSuccess(e))},fail:function(e){g.gre=null,s.testFail(e,"GRE有效分值为0~340")}}):"gmat"==g.exam&&$(this).testInput({rule:s.isInt,success:function(e){return e.val()<200||e.val()>800?(g.gmat=null,void s.testFail(e,"GMAT有效分值为200~800")):(g.gmat=e.val(),void s.testSuccess(e))},fail:function(e){g.gmat=null,s.testFail(e,"GMAT有效分值为200~800")}})}),$(".select-exam-v").on("input propertychange",function(){"gre"==g.exam?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>170?(g.gre_v=null,void s.testFail(e,"GRE分项（V、Q ）成绩有效分值为0~170")):(g.gre_v=e.val(),void s.testSuccess(e))},fail:function(e){g.gre_v=null,s.testFail(e,"GRE分项（V、Q ）成绩有效分值为0~170")}}):"gmat"==g.exam&&$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>60?(g.gmat_v=null,void s.testFail(e,"GMAT分项（V、Q) 有效成绩分值为0~60")):(g.gmat_v=e.val(),void s.testSuccess(e))},fail:function(e){g.gmat_v=null,s.testFail(e,"GMAT分项（V、Q) 有效成绩分值为0~60")}})}),$(".select-exam-q").on("input propertychange",function(){"gre"==g.exam?$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>170?(g.gre_q=null,void s.testFail(e,"GRE分项（V、Q ）成绩有效分值为0~170")):(g.gre_q=e.val(),void s.testSuccess(e))},fail:function(e){g.gre_q=null,s.testFail(e,"GRE分项（V、Q ）成绩有效分值为0~170")}}):"gmat"==g.exam&&$(this).testInput({rule:s.isInt,success:function(e){return e.val()<0||e.val()>60?(g.gmat_q=null,void s.testFail(e,"GMAT分项（V、Q) 有效成绩分值为0~60")):(g.gmat_q=e.val(),void s.testSuccess(e))},fail:function(e){g.gmat_q=null,s.testFail(e,"GMAT分项（V、Q) 有效成绩分值为0~60")}})}),$(".select-exam-aw").on("input propertychange",function(){a($(this),1),"gre"==g.exam?$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>6?(g.gre_aw=null,void s.testFail(e,"AW有效成绩分值为0~6")):(g.gre_aw=e.val(),void s.testSuccess(e))},fail:function(e){g.gre_aw=null,s.testFail(e,"AW有效成绩分值为0~6")}}):"gmat"==g.exam&&$(this).testInput({rule:s.isFloat,success:function(e){return e.val()<0||e.val()>6?(g.gmat_aw=null,void s.testFail(e,"AW有效成绩分值为0~6")):(g.gmat_aw=e.val(),void s.testSuccess(e))},fail:function(e){g.gmat_aw=null,s.testFail(e,"AW有效成绩分值为0~6")}})}),$(".select-exam-input input").on("focus",function(){$(this).hasClass("error")&&$(this).parent(".form-item").find(".form-item-notice").css("display","block")}),$(".select-exam-input input").on("blur",function(){$(this).parent(".form-item").find(".form-item-notice").css("display","none"),"gre"==g.exam?g.gre&&g.gre_v&&g.gre_q&&g.gre_aw&&$(".select-exam .form-item-name").removeClass("red"):"gmat"==g.exam&&g.gmat&&g.gmat_v&&g.gmat_q&&g.gmat_aw&&$(".select-exam .form-item-name").removeClass("red"),m()}),$(".select-lsat").on("blur",function(){0==$(".select-lsat").val()?(g.lsat=0,s.testSuccess($(this))):$(this).testInput({rule:s.isInt,success:function(e){return e.val()>180||e.val()<120?(g.lsat=null,void s.testFail(e,"LAST有效分值为120~180")):(g.lsat=e.val(),void s.testSuccess(e))},fail:function(e){g.lsat=null,s.testFail(e,"LAST有效分值为120~180")}}),console.log(null!==g.lsat),null!==g.lsat&&$(".select-form-lsat .form-item-name").removeClass("red"),m()}),$(".select-exchange .form-check").on("click",function(){var e=$(this).parents(".select-exchange").find(".form-check").index($(this));0==g.exchange[e]?g.exchange[e]=$(this).data("value"):g.exchange[e]=0}),$(".select-science .form-check").on("click",function(){var e=$(this).parents(".select-science").find(".form-check").index($(this));0==g.science_rank[e]?($(this).find(".form-select").removeClass("hidden"),$(this).find(".form-select")[0]&&(_[3]=parseInt(_[3])+$(this).find(".form-select").innerHeight()+"px"),g.science_rank[e]=$(this).data("value"),2==e?g.science_time[e]=1:g.science_time[e]=$(this).find(".form-select-option li").eq(0).data("value")):($(this).find(".form-select").addClass("hidden"),$(this).find(".form-select")[0]&&(_[3]=parseInt(_[3])-$(this).find(".form-select").innerHeight()+"px"),g.science_rank[e]=0,g.science_time[e]=0),$(".select-other").css("height",_[3])}),$(".select-science .form-select").on("click",function(e){e.stopPropagation()}),$(".select-science .form-select-option li").on("click",function(e){e.stopPropagation();var t=$(this).data("value"),l=$(this).parents(".form-item").find(".form-select").index($(this).parents(".form-select"));g.science_time[l]=t}),$(".select-recommend .form-check").on("click",function(){var e=$(this).parents(".select-recommend").find(".form-check").index($(this));0==g.recommend_rank[e]?g.recommend_rank[e]=$(this).data("value"):g.recommend_rank[e]=0,console.log(g.recommend_rank)}),$(".select-achievement .form-check").on("click",function(){var e=$(this).parents(".select-achievement").find(".form-check").index($(this));switch(e){case 0:$(this).find(".form-check-input").hasClass("hidden")?($(this).find(".form-check-input").removeClass("hidden"),_[3]=parseInt(_[3])+$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),g.achievement[e]=1):($(this).find(".form-check-input").addClass("hidden"),_[3]=parseInt(_[3])-$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),$(this).find(".form-check-input input").val(""),s.testSuccess($(this).find("input")),g.achievement[e]=0,g.international_paper_rank=[0,0,0],g.international_paper_num=[0,0,0]);break;case 1:$(this).find(".form-check-input").hasClass("hidden")?($(this).find(".form-check-input").removeClass("hidden"),_[3]=parseInt(_[3])+$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),g.achievement[e]=1):($(this).find(".form-check-input").addClass("hidden"),_[3]=parseInt(_[3])-$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),$(this).find(".form-check-input input").val(""),s.testSuccess($(this).find("input")),g.achievement[e]=0,g.chinese_paper_rank=[0,0,0],g.chinese_paper_num=[0,0,0]);break;case 2:$(this).find(".form-check-input").hasClass("hidden")?($(this).find(".form-check-input").removeClass("hidden"),_[3]=parseInt(_[3])+$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),g.achievement[e]=1):($(this).find(".form-check-input").addClass("hidden"),_[3]=parseInt(_[3])-$(this).find(".form-check-input").innerHeight()+"px",$(".select-other").css("height",_[3]),$(this).find(".form-check-input input").val(""),s.testSuccess($(this).find("input")),g.achievement[e]=0,g.meeting_paper_rank=[0,0],g.meeting_paper_num=[0,0])}0==g.achievement[e]&&0==g.achievement[1]&&0==g.achievement[2]&&($(".select-box").eq(3).find(".select-title").removeClass("error"),$(".select-achievement .form-item-name").eq(0).removeClass("red"))}),$(".select-achievement .form-check-input").on("click",function(e){e.stopPropagation()}),$(".select-achievement .form-check-input input").on("blur",function(){function e(e){for(var t=0;t<e.length;t++)if(e[t]>0)return!0;return!1}$(this).testInput({rule:s.isInt,success:function(e){var t=parseInt(e.val()),l=e.parents(".form-check-input").find("input").index(e),n=e.parents(".select-achievement").find(".form-check").index(e.parents(".form-check"));switch(n){case 0:g.international_paper_rank[l]=e.data("value"),g.international_paper_num[l]=t;break;case 1:g.chinese_paper_rank[l]=e.data("value"),g.chinese_paper_num[l]=t;break;case 2:g.meeting_paper_rank[l]=e.data("value"),g.meeting_paper_num[l]=t}s.testSuccess(e)},fail:function(e){var t=e.parents(".form-check-input").find("input").index(e),l=e.parents(".select-achievement").find(".form-check").index(e.parents(".form-check"));
switch(l){case 0:g.international_paper_rank[t]=0,g.international_paper_num[t]=0;break;case 1:g.chinese_paper_rank[t]=0,g.chinese_paper_num[t]=0;break;case 2:g.meeting_paper_rank[t]=0,g.meeting_paper_num[t]=0}s.testFail(e,"请输入整数数字")}}),(1!=g.achievement[0]||e(g.international_paper_num))&&(1!=g.achievement[1]||e(g.chinese_paper_num))&&(1!=g.achievement[2]||e(g.meeting_paper_num))&&($(".select-box").eq(3).find(".select-title").removeClass("error"),$(".select-achievement .form-item-name").eq(0).removeClass("red"))}),$(".select-work .form-check").on("click",function(){var e=$(this).parents(".select-work").find(".form-check").index($(this));0==g.work_rank[e]?($(this).find(".form-select").removeClass("hidden"),$(this).find(".form-select")[0]&&(_[3]=parseInt(_[3])+$(this).find(".form-select").innerHeight()+"px"),g.work_rank[e]=$(this).data("value"),2==e?g.work_time[e]=1:g.work_time[e]=$(this).find(".form-select-option li").eq(0).data("value")):($(this).find(".form-select").addClass("hidden"),$(this).find(".form-select")[0]&&(_[3]=parseInt(_[3])-$(this).find(".form-select").innerHeight()+"px"),g.work_rank[e]=0,g.work_time[e]=0),$(".select-other").css("height",_[3])}),$(".select-work .form-select").on("click",function(e){e.stopPropagation()}),$(".select-work .form-select-option li").on("click",function(e){e.stopPropagation();var t=$(this).index()+1,l=$(this).parents(".form-item").find(".form-select").index($(this).parents(".form-select"));g.work_time[l]=t}),$(".select-prize .form-check").on("click",function(){var e=$(this).parents(".select-prize").find(".form-check").index($(this));switch(e){case 0:$(this).find(".form-select").hasClass("hidden")?($(this).find(".form-select").removeClass("hidden"),_[3]=parseInt(_[3])+$(this).find(".form-select").innerHeight()+"px",$(".select-other").css("height",_[3]),g.prize=$(this).find(".form-select-option li").eq(0).data("value")):($(this).find(".form-select").addClass("hidden"),_[3]=parseInt(_[3])-$(this).find(".form-select").innerHeight()+"px",$(".select-other").css("height",_[3]),g.prize=0);break;case 1:$(this).find(".form-select").hasClass("hidden")?($(this).find(".form-select").removeClass("hidden"),_[3]=parseInt(_[3])+$(this).find(".form-select").innerHeight()+"px",$(".select-other").css("height",_[3]),g.match=$(this).find(".form-select-option li").eq(0).data("value")):($(this).find(".form-select").addClass("hidden"),_[3]=parseInt(_[3])-$(this).find(".form-select").innerHeight()+"px",$(".select-other").css("height",_[3]),g.match=0)}}),$(".select-prize .form-select").on("click",function(e){e.stopPropagation()}),$(".select-prize .form-select-option li").on("click",function(e){e.stopPropagation();var t=($(this).data("value"),$(this).parents(".form-item").find(".form-select").index($(this).parents(".form-select")));switch(t){case 0:g.prize=$(this).data("value");break;case 1:g.match=$(this).data("value")}console.log(g.prize),console.log(g.match)}),$(".select-submit").on("click",function(){u()}),$(".select-school").tab(),$(".school-list-main").on("mouseenter",function(){$(this).parent("li").hasClass("active")||($(this).animate({marginTop:0},200),$(this).find(".school-list-info").animate({height:40},200),$(this).find(".school-list-mask").fadeIn(200),$(this).find(".school-list-logo").addClass("blur"))}).on("mouseleave",function(){return $(this).parent("li").hasClass("active")?void $(this).find(".school-list-mask").fadeOut(200):($(this).animate({marginTop:40},200),$(this).find(".school-list-info").animate({height:0},200),$(this).find(".school-list-mask").fadeOut(200),void $(this).find(".school-list-logo").removeClass("blur"))}),$(".school-list-major span")[0]&&$(".school-list-major span").html().length>25&&($(".school-list-major span").html($(".school-list-major span").html().substring(0,25)+"..."),$(".school-list-info").on("mouseenter",function(e){e.stopPropagation(),$(this).find(".school-list-major-all").removeClass("hidden")}).on("mouseleave",function(e){e.stopPropagation(),$(this).find(".school-list-major-all").addClass("hidden")})),$(".switch-box").on("click",function(){$(this).hasClass("on")?($(this).find("img").animate({left:0},100),$(this).removeClass("on").addClass("off"),$(this).parent(".school-list-switch").find("span").html("点击加入申请")):$(this).hasClass("off")&&($(this).find("img").animate({left:30},100),$(this).removeClass("off").addClass("on"),$(this).parent(".school-list-switch").find("span").html("点击取消申请"))}),$(".school-list-main").on("click",function(e){if(!$(this).parent("li").hasClass("active")){$(".select-school-list li.active").find(".school-list-main").animate({marginTop:40},200),$(".select-school-list li.active").find(".school-list-info").animate({height:0},200),$(".select-school-list li").removeClass("active"),$(".select-school-list li").find(".school-list-mask").fadeOut(200),$(".select-school-list li").find(".school-list-logo").removeClass("blur"),$(this).parent("li").addClass("active"),$(this).parents(".tab-box").find(".select-school-rank").html($(this).parent("li").find(".school-list-rank").html());var t=$(this).parent("li").attr("school-id");console.log(t,"切换学校"),$.ajax({url:"/v1/Completeform/historyoffer.action",data:{id:t},type:"get",cache:!1,dataType:"json",success:function(e){console.log(e),$(".select-dis-gpa span").html(i(e.data.gpa.user_data.y)),$(".select-dis-tofel span").html(i(e.data.toefl.user_data.y)),$(".select-dis-gre span").html(i(e.data.gre.user_data.y)),p(".select-svg-gpa",e.data.gpa.data,e.data.gpa.max,e.data.gpa.user_data),p(".select-svg-tofel",e.data.toefl.data,e.data.toefl.max,e.data.toefl.user_data),p(".select-svg-gre",e.data.gre.data,e.data.gre.max,e.data.gre.user_data),$(".select-school-chart .hardrate span").html(i(e.data.hard)),$(".select-school-chart .softrate span").html(i(e.data.soft)),$(".select-chart-summary .countrate span").html(i(e.data.count)),$(".select-chart-summary .match span").html(e.data.match)},error:function(){s.notice("网络错误")}})}}),$(".select-school-switch").on("click",function(e){e.stopPropagation(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")})}),s.closeAll.closeSelectView=function(){s.closeMask(),$("body").css("overflow","auto"),$(".select-form-view").addClass("animated fadeOutUp").one(s.animationend,function(){$(".select-form-view").removeClass("animated fadeOutUp").addClass("hidden")})},$(".select-form-noresult-info").on("click",function(e){e.stopPropagation(),$(".select-form-noresult").addClass("hidden"),$(".mask").addClass("hidden")})});